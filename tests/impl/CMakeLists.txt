cmake_minimum_required(VERSION 3.12.0)
project(asynqro_impl_tests LANGUAGES CXX)

add_executable(asynqro_impl_tests
    main.cpp
    containers_traverse_test.cpp
    containers_traverse_flatten_test.cpp
    containers_traverse_reduce_test.cpp
    containers_traverse_map_one_socket_test.cpp
    containers_traverse_map_two_sockets_test.cpp
    taskslist_test.cpp
    spinlock_test.cpp
)
set_target_properties(asynqro_impl_tests PROPERTIES
    CXX_STANDARD 17
    CXX_STANDARD_REQUIRED ON
    CXX_EXTENSIONS OFF
    POSITION_INDEPENDENT_CODE ON
)

target_link_libraries(asynqro_impl_tests asynqro::asynqro gtest)
target_include_directories(asynqro_impl_tests PRIVATE
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/..>
    )
if (ASYNQRO_QT_SUPPORT)
    target_sources(asynqro_impl_tests PRIVATE containers_traverse_map_no_sockets_test.cpp)
endif()

if (NOT DEFINED ENV{APPVEYOR})
    gtest_discover_tests(asynqro_impl_tests DISCOVERY_TIMEOUT 30 PROPERTIES TIMEOUT 30)
endif()
